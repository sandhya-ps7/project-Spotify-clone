<%- include('partials/header', { title: 'Dashboard' }) %>

<div class="dashboard-container">
    <div class="container">
        <!-- Welcome Section -->
        <section class="welcome-section">
            <div class="welcome-content">
                <h1>Welcome back, <span class="gradient-text"><%= user.username %></span>!</h1>
                <p>Ready to discover your next favorite song?</p>
            </div>
            <div class="quick-stats">
                <div class="stat-card">
                    <i class="fas fa-list"></i>
                    <div>
                        <h3><%= playlists.length %></h3>
                        <p>Playlists</p>
                    </div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-heart"></i>
                    <div>
                        <h3><%= liked.length %></h3>
                        <p>Liked Songs</p>
                    </div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-clock"></i>
                    <div>
                        <h3><%= recent.length %></h3>
                        <p>Recently Played</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Recently Played -->
        <section class="section">
            <div class="section-header">
                <h2><i class="fas fa-history"></i> Recently Played</h2>
                <a href="/browse" class="see-all">See All <i class="fas fa-arrow-right"></i></a>
            </div>
            
            <% if (recent && recent.length > 0) { %>
                <div class="songs-grid">
                    <% recent.forEach(song => { %>
                        <div class="song-card" data-song-id="<%= song.id %>">
                            <div class="song-image">
                                <img src="/<%= song.cover_image || 'assets/default-cover.jpg' %>" alt="<%= song.title %>">
                                <div class="play-overlay">
                                    <button class="play-button" onclick="playSong(<%= song.id %>, '<%= song.title %>', '<%= song.artist %>')">
                                        <i class="fas fa-play"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="song-info">
                                <h3><a href="/song/<%= song.id %>"><%= song.title %></a></h3>
                                <p><%= song.artist %></p>
                                <div class="song-stats">
                                    <span><i class="fas fa-play-circle"></i> <%= song.play_count.toLocaleString() %></span>
                                    <span><i class="fas fa-heart"></i> <%= song.likes_count %></span>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                </div>
            <% } else { %>
                <div class="empty-state">
                    <i class="fas fa-music"></i>
                    <h3>No recently played songs</h3>
                    <p>Start listening to your favorite music</p>
                    <a href="/browse" class="btn-hero primary">Browse Music</a>
                </div>
            <% } %>
        </section>

        <!-- Your Playlists -->
        <section class="section bg-dark">
            <div class="section-header">
                <h2><i class="fas fa-list-ul"></i> Your Playlists</h2>
                <a href="/playlists" class="see-all">View All <i class="fas fa-arrow-right"></i></a>
            </div>
            
            <% if (playlists && playlists.length > 0) { %>
                <div class="playlists-grid">
                    <% playlists.slice(0, 4).forEach(playlist => { %>
                        <a href="/playlist/<%= playlist.id %>" class="playlist-card">
                            <div class="playlist-image">
                                <% if (playlist.cover_image) { %>
                                    <img src="/<%= playlist.cover_image %>" alt="<%= playlist.name %>">
                                <% } else { %>
                                    <div class="playlist-default">
                                        <i class="fas fa-music"></i>
                                    </div>
                                <% } %>
                            </div>
                            <div class="playlist-info">
                                <h3><%= playlist.name %></h3>
                                <p><%= playlist.total_songs %> songs</p>
                                <% if (playlist.description) { %>
                                    <span class="playlist-desc"><%= playlist.description.substring(0, 50) %>...</span>
                                <% } %>
                            </div>
                        </a>
                    <% }); %>
                    
                    <div class="playlist-card create-new">
                        <div class="create-content">
                            <i class="fas fa-plus-circle"></i>
                            <h3>Create New Playlist</h3>
                            <p>Build your perfect collection</p>
                        </div>
                    </div>
                </div>
            <% } else { %>
                <div class="empty-state">
                    <i class="fas fa-list"></i>
                    <h3>No playlists yet</h3>
                    <p>Create your first playlist to organize your music</p>
                    <a href="/playlists" class="btn-hero primary">Create Playlist</a>
                </div>
            <% } %>
        </section>

        <!-- Liked Songs -->
        <section class="section">
            <div class="section-header">
                <h2><i class="fas fa-heart"></i> Liked Songs</h2>
                <a href="/liked" class="see-all">See All <i class="fas fa-arrow-right"></i></a>
            </div>
            
            <% if (liked && liked.length > 0) { %>
                <div class="songs-grid">
                    <% liked.forEach(song => { %>
                        <div class="song-card" data-song-id="<%= song.id %>">
                            <div class="song-image">
                                <img src="/<%= song.cover_image || 'assets/default-cover.jpg' %>" alt="<%= song.title %>">
                                <div class="play-overlay">
                                    <button class="play-button" onclick="playSong(<%= song.id %>, '<%= song.title %>', '<%= song.artist %>')">
                                        <i class="fas fa-play"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="song-info">
                                <h3><a href="/song/<%= song.id %>"><%= song.title %></a></h3>
                                <p><%= song.artist %></p>
                                <div class="song-stats">
                                    <span><i class="fas fa-play-circle"></i> <%= song.play_count.toLocaleString() %></span>
                                    <span><i class="fas fa-heart"></i> <%= song.likes_count %></span>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                </div>
            <% } else { %>
                <div class="empty-state">
                    <i class="fas fa-heart-broken"></i>
                    <h3>No liked songs yet</h3>
                    <p>Start liking songs to build your collection</p>
                    <a href="/browse" class="btn-hero primary">Discover Music</a>
                </div>
            <% } %>
        </section>
    </div>
</div>

<style>
.dashboard-container {
    min-height: calc(100vh - 200px);
    padding: 40px 0;
}

.welcome-section {
    background: var(--gradient);
    border-radius: 24px;
    padding: 50px;
    margin-bottom: 60px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: var(--shadow-lg);
}

.welcome-content h1 {
    font-size: 42px;
    font-weight: 900;
    color: white;
    margin-bottom: 12px;
}

.welcome-content p {
    font-size: 18px;
    color: rgba(255, 255, 255, 0.9);
}

.quick-stats {
    display: flex;
    gap: 20px;
}

.stat-card {
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    padding: 25px 30px;
    border-radius: 16px;
    display: flex;
    align-items: center;
    gap: 15px;
    min-width: 160px;
    transition: all 0.3s ease;
}

.stat-card:hover {
    background: rgba(255, 255, 255, 0.25);
    transform: translateY(-5px);
}

.stat-card i {
    font-size: 32px;
    color: white;
}

.stat-card h3 {
    font-size: 32px;
    font-weight: 900;
    color: white;
    margin-bottom: 4px;
}

.stat-card p {
    font-size: 14px;
    color: rgba(255, 255, 255, 0.9);
}

.playlists-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 30px;
}

.playlist-card {
    background: var(--surface);
    border-radius: 16px;
    padding: 20px;
    transition: all 0.3s ease;
    cursor: pointer;
}

.playlist-card:hover {
    background: var(--surface-light);
    transform: translateY(-5px);
    box-shadow: var(--shadow);
}

.playlist-image {
    aspect-ratio: 1;
    border-radius: 12px;
    overflow: hidden;
    margin-bottom: 16px;
}

.playlist-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.playlist-default {
    width: 100%;
    height: 100%;
    background: var(--gradient);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 64px;
    color: white;
}

.playlist-info h3 {
    font-size: 18px;
    margin-bottom: 8px;
}

.playlist-info p {
    color: var(--text-secondary);
    font-size: 14px;
    margin-bottom: 8px;
}

.playlist-desc {
    color: var(--text-secondary);
    font-size: 13px;
}

.playlist-card.create-new {
    border: 2px dashed var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 300px;
}

.playlist-card.create-new:hover {
    border-color: var(--primary);
}

.create-content {
    text-align: center;
}

.create-content i {
    font-size: 64px;
    color: var(--primary);
    margin-bottom: 20px;
}

.create-content h3 {
    margin-bottom: 8px;
}

.create-content p {
    color: var(--text-secondary);
}

.empty-state {
    text-align: center;
    padding: 80px 20px;
}

.empty-state i {
    font-size: 72px;
    color: var(--text-secondary);
    margin-bottom: 20px;
}

.empty-state h3 {
    font-size: 28px;
    margin-bottom: 12px;
}

.empty-state p {
    color: var(--text-secondary);
    font-size: 16px;
    margin-bottom: 30px;
}

@media (max-width: 1024px) {
    .welcome-section {
        flex-direction: column;
        text-align: center;
        gap: 30px;
    }
    
    .quick-stats {
        width: 100%;
        justify-content: center;
    }
}

@media (max-width: 768px) {
    .quick-stats {
        flex-direction: column;
    }
    
    .stat-card {
        width: 100%;
    }
}
</style>

<%- include('partials/footer') %>